<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Micrometer</title>
    <link rel="canonical" href="https://docs.micrometer.io/micrometer/reference/observation/instrumenting.html">
    <link rel="prev" href="handler.html">
    <link rel="next" href="testing.html">
    <meta name="generator" content="Antora 3.2.0-alpha.2">
    <script>
!function (theme, navWidth) {
  if (theme === 'dark') document.documentElement.classList.add('dark-theme')
  if (navWidth) document.documentElement.style.setProperty('--nav-width', `${navWidth}px`)
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'),
  localStorage && localStorage.getItem('nav-width'))
    </script>
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/vendor/search.css">
    <link rel="stylesheet" href="../../_/css/vendor/page-search.css">
    <link rel="stylesheet" href="../../_/css/vendor/asciidoctor-tabs.css">

    <meta name="version" content="1.13.0">
    <meta name="component" content="micrometer">
    <meta name="latest-version" content="false">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://micrometer.io">
        <img
          id="springlogo"
          class="block light"
          src="../../_/img/micrometer-logo.svg"
          alt="Micrometer"
        />
        <img
          id="springlogo"
          class="block dark"
          src="../../_/img/micrometer-logo-dark.svg"
          alt="Micrometer"
        />
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

      </div>
    </div>
    <label class="theme-toggler">
      <input
        type="checkbox"
        type="checkbox"
        id="switch-theme-checkbox"
        name="switch-theme-checkbox"
      />
      <span class="icon"><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="moon"
          class="svg-inline--fa fa-moon moon"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 384 512"
        ><path
            fill="currentColor"
            d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"
          ></path>
        </svg>
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="sun"
          class="svg-inline--fa fa-sun sun"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        ><path
            fill="currentColor"
            d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"
          ></path>
        </svg></span>
      <span class="text">light</span>
    </label>
  </nav>
</header>
<script>
!function (theme) {
  if (theme === 'dark') {
    document.getElementById('switch-theme-checkbox').parentElement.classList.add('active')
  }
}(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)') && 'dark'))
</script>
<div class="body">
<div class="nav-container" data-component="micrometer" data-version="1.13.0">
  <aside class="nav">
    <div class="panels">
      <div class="nav-panel-menu is-active" data-panel="menu">
        <nav class="nav-menu">
<div class="context">
  <span class="title">Micrometer</span>
  <span class="version">1.13.0-SNAPSHOT</span>
  <button class="browse-version" id="browse-version">
    <svg
      height="24px"
      id="Layer_1"
      style="enable-background:new 0 0 512 512;"
      version="1.1"
      viewBox="0 0 512 512"
      width="24px"
      xml:space="preserve"
    ><g><path
          d="M256,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S273.7,224,256,224L256,224z"
        ></path><path
          d="M128.4,224c-17.7,0-32,14.3-32,32s14.3,32,32,32c17.7,0,32-14.3,32-32S146,224,128.4,224L128.4,224z"
        ></path><path
          d="M384,224c-17.7,0-32,14.3-32,32s14.3,32,32,32s32-14.3,32-32S401.7,224,384,224L384,224z"
        ></path></g></svg>
  </button>
</div><div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    <span>Search</span>
    <span class="search-key"></span>
  </button>
</div>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../installing.html">Installing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../concepts.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/implementations.html">Supported Monitoring Systems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/registry.html">Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/meters.html">Meters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/naming.html">Naming Meters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/meter-filters.html">Meter Filters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/rate-aggregation.html">Rate Aggregation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/counters.html">Counters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/gauges.html">Gauges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/timers.html">Timers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/distribution-summaries.html">Distribution Summaries</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/long-task-timers.html">Long Task Timers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../concepts/histogram-quantiles.html">Histograms and Percentiles</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../implementations.html">Implementations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/appOptics.html">AppOptics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/atlas.html">Atlas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/cloudwatch.html">CloudWatch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/datadog.html">Datadog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/dynatrace.html">Dynatrace</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/elastic.html">Elasticsearch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/ganglia.html">Ganglia</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/graphite.html">Graphite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/humio.html">Humio</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/influx.html">Influx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/instana.html">Instana</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/jmx.html">JMX</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/kairos.html">KairosDB</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/new-relic.html">New Relic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/otlp.html">OpenTelemetry Protocol (OTLP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/prometheus.html">Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/signalFx.html">SignalFx</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/stackdriver.html">Stackdriver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/statsD.html">statsD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../implementations/wavefront.html">Wavefront</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../reference.html">Reference Instrumentations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/jvm.html">JVM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/cache.html">Cache</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/okhttpclient.html">OkHttpClient</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/jetty.html">Jetty and Jersey</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../reference/netty.html">Netty</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../guides.html">Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/console-reporter.html">Passing through to Dropwizard&#8217;s console reporter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/http-sender-resilience4j-retry.html">HttpSender with Resilience4j retry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../guides/custom-meter-registry.html">Custom meter registry</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../observation.html">Micrometer Observation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="installing.html">Installing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="handler.html">Observation Handlers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="instrumenting.html">Instrumenting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="testing.html">Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="projects.html">Instrumented Projects</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
          <div class="toggle-sm">
            <button id="nav-toggle-2" class="nav-toggle"></button>
          </div>
        </nav>
      </div>
      <div class="nav-collapse">
        <button id="nav-collapse-toggle"><span></span></button>        
      </div>
    </div>
    <div class="nav-resize"></div>
  </aside>
</div>
<script>
!function (sidebar) {
  if (sidebar) {
    document.body.classList.add('nav-sm')
  }
}(localStorage && localStorage.getItem('sidebar') === 'close')
</script><main class="article">
<div class="toolbar" role="navigation">
  <button id="nav-toggle-1" class="nav-toggle"></button>
<div class="search">
  <button class="DocSearch-Button search-button">
    <svg enable-background="new 0 0 32 32" id="Glyph" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
      <path d="M27.414,24.586l-5.077-5.077C23.386,17.928,24,16.035,24,14c0-5.514-4.486-10-10-10S4,8.486,4,14  s4.486,10,10,10c2.035,0,3.928-0.614,5.509-1.663l5.077,5.077c0.78,0.781,2.048,0.781,2.828,0  C28.195,26.633,28.195,25.367,27.414,24.586z M7,14c0-3.86,3.14-7,7-7s7,3.14,7,7s-3.14,7-7,7S7,17.86,7,14z" id="XMLID_223_"/>
    </svg>
    <span>Search</span>
    <span class="search-key"></span>
  </button>
</div>
</div>
  <div class="content">
<aside class="sidebar">
  <div class="content">
    <div
      class="toc"
      data-title=""
      data-levels="2"
    >
      <div class="toc-menu"></div>
    </div>
    <div class="sidebar-links">
        <a href="https://github.com/micrometer-metrics/micrometer/edit/main/docs/modules/ROOT/pages/observation/instrumenting.adoc">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24"
            viewBox="0 0 24 24"
            width="24"
          ><path
              d="m16 2.012 3 3L16.713 7.3l-3-3zM4 14v3h3l8.299-8.287-3-3zm0 6h16v2H4z"
            ></path></svg>
          Edit this Page
        </a>
              <a href="https://github.com/micrometer-metrics/micrometer" title="Github">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="512px"
            id="Layer_1"
            version="1.1"
            viewBox="0 0 512 512"
            width="512px"
          ><style type="text/css"><![CDATA[
              .st0{fill-rule:evenodd;clip-rule:evenodd;} ]]></style><g><path
                class="st0"
                d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"
              ></path></g></svg>
          GitHub Project
        </a>
        <a href="https://stackoverflow.com/tags/micrometer">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path
              d="M290.7 311L95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"
            ></path></svg>
          Stack Overflow
        </a>
    </div>
  </div>
</aside><div class="doc">
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Micrometer</a></li>
    <li><a href="../observation.html">Micrometer Observation</a></li>
    <li><a href="instrumenting.html">Instrumenting</a></li>
  </ul>
</nav>
<article>
<div class="admonitionblock important">
  <table>
    <tbody><tr>
      <td class="icon">
        <i class="fa icon-important" title="Important"></i>
      </td>
      <td class="content">
        <div class="paragraph">
          <p>This version is still in development and is not considered stable yet. For the latest stable version, please use <a href="../../observation/instrumenting.html">Micrometer 1.12.1</a>!</p>
        </div>
      </td>
    </tr></tbody>
  </table>
</div>
<div class="paragraph">
<p>In this section we will see some common examples of reusing existing Micrometer and Micrometer Tracing handlers and context types to do instrumentation.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Before you decide to instrument a project yourself, please double-check whether it hasn&#8217;t already been instrumented!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To better understand how you can do instrumentation we need to distinguish two concepts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Context propagation</p>
</li>
<li>
<p>Creation of Observations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Context propagation</strong> - we propagate existing context through threads or network. We&#8217;re using the <a href="https://micrometer.io/docs/contextPropagation">Micrometer Context Propagation</a> library to define the context and to propagate it through threads. We&#8217;re using dedicated <code>SenderContext</code> and <code>ReceiverContext</code> objects, together with Micrometer Tracing handlers, to create Observations that will propagate context over the wire.</p>
</div>
<div class="paragraph">
<p><strong>Creation of Observations</strong> - we want to wrap an operation in an Observation to get measurements. We need to know if there previously has been a parent Observation to maintain the parent-child relationship of Observations.</p>
</div>
<div class="sect1">
<h2 id="instrumentation_of_thread_switching_components"><a class="anchor" href="#instrumentation_of_thread_switching_components"></a>Instrumentation of Thread Switching Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We might want to create an Observation around a <code>Runnable</code> or <code>Callable</code> that we&#8217;re submitting through an <code>Executor</code>. For that to work we need to know if in the parent thread there was an Observation that the new thread should continue, or for which a child Observation should be created.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// Example of an Executor Service
ExecutorService executor = Executors.newCachedThreadPool();


// This snippet shows an example of how to wrap in an observation code that would
// be executed in a separate thread

// Let's assume that we have a parent observation
Observation parent = Observation.createNotStarted("parent", registry);
// Observation is put in scope via the &lt;observe()&gt; method
Future&lt;Boolean&gt; child = parent.observe(() -&gt; {
    // [Thread 1] Current Observation is the same as &lt;parent&gt;
    then(registry.getCurrentObservation()).isSameAs(parent);
    // [Thread 1] We're wrapping the executor in a Context Propagating version.
    // &lt;ContextExecutorService&gt; comes from Context Propagation library
    return ContextExecutorService.wrap(executor).submit(() -&gt; {
        // [Thread 2] Current Observation is same as &lt;parent&gt; - context got
        // propagated
        then(registry.getCurrentObservation()).isSameAs(parent);
        // Wraps the code that should be run in a separate thread in an
        // observation
        return Observation.createNotStarted("child", registry).observe(this::yourCodeToMeasure);
    });
});</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instrumentation_of_reactive_libraries"><a class="anchor" href="#instrumentation_of_reactive_libraries"></a>Instrumentation of Reactive Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we&#8217;ll discuss how to wrap Reactive libraries in Observations and how to use Reactor Context to safely propagate Observations between threads.</p>
</div>
<div class="sect2">
<h3 id="instrumentation_of_reactive_libraries_after_reactor_3_5_3"><a class="anchor" href="#instrumentation_of_reactive_libraries_after_reactor_3_5_3"></a>For Reactor 3.5.3 and After</h3>
<div class="paragraph">
<p>In Reactor 3.5.3 release (through this <a href="https://github.com/reactor/reactor-core/pull/3335">PR</a>) an option to turn on automated context propagation was added. To use this, please ensure that you&#8217;re using the following projects at minimum in the following versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reactor <a href="https://github.com/reactor/reactor-core/releases/tag/v3.5.7">3.5.7</a></p>
</li>
<li>
<p>Micrometer Context-Propagation <a href="https://github.com/micrometer-metrics/context-propagation/releases/tag/v1.0.3">1.0.3</a></p>
</li>
<li>
<p>Micrometer <a href="https://github.com/micrometer-metrics/micrometer/releases/tag/v1.10.8">1.10.8</a></p>
</li>
<li>
<p>Micrometer Tracing <a href="https://github.com/micrometer-metrics/tracing/releases/tag/v1.0.7">1.0.7</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the feature call the new Reactor&#8217;s Hook method (e.g. in your <code>public static void main</code> method) like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Hooks.enableAutomaticContextPropagation();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically wrap Reactor internal mechanisms to propagate context between operators, threads etc. Usage of <code>tap</code> and <code>handle</code> or Context Propagation API is not required.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This snippet shows an example of how to use the new Hook API with Reactor
Hooks.enableAutomaticContextPropagation();
// Starting from Micrometer 1.10.8 you need to set your registry on this singleton
// instance of OTLA
ObservationThreadLocalAccessor.getInstance().setObservationRegistry(registry);

// Let's assume that we have a parent observation
Observation parent = Observation.start("parent", registry);
// Now we put it in thread local
parent.scoped(() -&gt; {

    // Example of propagating whatever there was in thread local
    Integer block = Mono.just(1).publishOn(Schedulers.boundedElastic()).doOnNext(integer -&gt; {
        log.info("Context Propagation happens - the &lt;parent&gt; observation gets propagated ["
                + registry.getCurrentObservation() + "]");
        then(registry.getCurrentObservation()).isSameAs(parent);
    })
        .flatMap(integer -&gt; Mono.just(integer).map(monoInteger -&gt; monoInteger + 1))
        .transformDeferredContextual((integerMono, contextView) -&gt; integerMono.doOnNext(integer -&gt; {
            log.info("Context Propagation happens - the &lt;parent&gt; observation gets propagated ["
                    + registry.getCurrentObservation() + "]");
            then(registry.getCurrentObservation()).isSameAs(parent);
        }))
        // Let's assume that we're modifying the context
        .contextWrite(context -&gt; context.put("foo", "bar"))
        // Since we are NOT part of the Reactive Chain (e.g. this is not a
        // WebFlux application)
        // you MUST call &lt;contextCapture&gt; to capture all ThreadLocal values
        // and store them in a Reactor Context.
        // ----------------------
        // If you were part of the
        // Reactive Chain (e.g. returning Mono from endpoint)
        // there is NO NEED to call &lt;contextCapture&gt;. If you need to propagate
        // your e.g. Observation
        // to the Publisher you just created (e.g. Mono or Flux) please
        // consider adding it
        // to the Reactor Context directly instead of opening an Observation
        // scope and calling &lt;contextCapture&gt; (see example below).
        .contextCapture()
        .block();

    // We're still using &lt;parent&gt; as current observation
    then(registry.getCurrentObservation()).isSameAs(parent);

    then(block).isEqualTo(2);

    // Now, we want to create a child observation for a Reactor stream and put it
    // to Reactor Context
    // Automatically its parent will be &lt;parent&gt; observation since &lt;parent&gt; is in
    // Thread Local
    Observation child = Observation.start("child", registry);
    block = Mono.just(1).publishOn(Schedulers.boundedElastic()).doOnNext(integer -&gt; {
        log.info(
                "Context Propagation happens - the &lt;child&gt; observation from Reactor Context takes precedence over thread local &lt;parent&gt; observation ["
                        + registry.getCurrentObservation() + "]");
        then(registry.getCurrentObservation()).isSameAs(child);
    })
        .flatMap(integer -&gt; Mono.just(integer).map(monoInteger -&gt; monoInteger + 1))
        .transformDeferredContextual((integerMono, contextView) -&gt; integerMono.doOnNext(integer -&gt; {
            log.info(
                    "Context Propagation happens - the &lt;child&gt; observation from Reactor Context takes precedence over thread local &lt;parent&gt; observation ["
                            + registry.getCurrentObservation() + "]");
            then(registry.getCurrentObservation()).isSameAs(child);
        }))
        // Remember to stop the child Observation!
        .doFinally(signalType -&gt; child.stop())
        // When using Reactor we ALWAYS search for
        // ObservationThreadLocalAccessor.KEY entry in the Reactor Context to
        // search for an Observation. You DON'T have to use &lt;contextCapture&gt;
        // because
        // you have manually provided the ThreadLocalAccessor key
        .contextWrite(context -&gt; context.put(ObservationThreadLocalAccessor.KEY, child))
        .block();

    // We're back to having &lt;parent&gt; as current observation
    then(registry.getCurrentObservation()).isSameAs(parent);

    then(block).isEqualTo(2);
});

// There should be no remaining observation
then(registry.getCurrentObservation()).isNull();

// We need to stop the parent
parent.stop();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If performance of this approach is not satisfactory, please verify whether disabling the hook and explicitly using <code>handle</code> or <code>tap</code> operators improves the performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="instrumentation_of_reactive_libraries_before_reactor_3_5_3"><a class="anchor" href="#instrumentation_of_reactive_libraries_before_reactor_3_5_3"></a>Before Reactor 3.5.3</h3>
<div class="paragraph">
<p>The preferred way of propagating elements through the Flux using Reactor is not via <code>ThreadLocal</code>s but through Reactor Context. Reactor however gives you two operators, <code>tap()</code> and <code>handle()</code> where, if <a href="https://micrometer.io/docs/contextPropagation">Micrometer Context Propagation</a> library is on the classpath, it will set thread local values for you.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This snippet shows an example of how to wrap code that is using Reactor

// Let's assume that we have a parent observation
Observation parent = Observation.start("parent", registry);

// We want to create a child observation for a Reactor stream
Observation child = Observation.start("child", registry)
    // There's no thread local entry, so we will pass parent observation
    // manually. If we put the Observation in scope we could then call
    // &lt;.contextCapture()&gt; method from Reactor to capture all thread locals
    // and store them in Reactor Context.
    .parentObservation(parent);
Integer block = Mono.just(1)
    // Example of not propagating context by default
    .doOnNext(integer -&gt; {
        log.info(
                "No context propagation happens by default in Reactor - there will be no Observation in thread local here ["
                        + registry.getCurrentObservation() + "]");
        then(registry.getCurrentObservation()).isNull();
    })
    // Example of having entries in thread local for &lt;tap()&gt; operator
    .tap(() -&gt; new DefaultSignalListener&lt;Integer&gt;() {
        @Override
        public void doFirst() throws Throwable {
            log.info("We're using tap() -&gt; there will be Observation in thread local here ["
                    + registry.getCurrentObservation() + "]");
            then(registry.getCurrentObservation()).isNotNull();
        }
    })
    .flatMap(integer -&gt; Mono.just(integer).map(monoInteger -&gt; monoInteger + 1))
    // Example of retrieving ThreadLocal entries via ReactorContext
    .transformDeferredContextual((integerMono, contextView) -&gt; integerMono.doOnNext(integer -&gt; {
        try (ContextSnapshot.Scope scope = ContextSnapshot.setAllThreadLocalsFrom(contextView)) {
            log.info(
                    "We're retrieving thread locals from Reactor Context - there will be Observation in thread local here ["
                            + registry.getCurrentObservation() + "]");
            then(registry.getCurrentObservation()).isNotNull();
        }
    }))
    // Example of having entries in thread local for &lt;handle()&gt; operator
    .handle((BiConsumer&lt;Integer, SynchronousSink&lt;Integer&gt;&gt;) (integer, synchronousSink) -&gt; {
        log.info("We're using handle() -&gt; There will be Observation in thread local here ["
                + registry.getCurrentObservation() + "]");
        then(registry.getCurrentObservation()).isNotNull();
        synchronousSink.next(integer);
    })
    // Remember to stop the child Observation!
    .doFinally(signalType -&gt; child.stop())
    // When using Reactor we ALWAYS search for
    // ObservationThreadLocalAccessor.KEY entry in the Reactor Context to
    // search for an Observation
    .contextWrite(context -&gt; context.put(ObservationThreadLocalAccessor.KEY, child))
    // If there were ThreadLocal entries that are using Micrometer Context
    // Propagation they would be caught here. All implementations of
    // &lt;ThreadLocalAccessor&gt; will store their thread local entries under their
    // keys in Reactor Context
    .contextCapture()
    .block();

// We didn't have any observations in thread local
then(registry.getCurrentObservation()).isNull();

// We need to stop the parent
parent.stop();

then(block).isEqualTo(2);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="instrumentation_of_http_communication"><a class="anchor" href="#instrumentation_of_http_communication"></a>Instrumentation of HTTP Communication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to instrument an HTTP-based communication we need to use the <code>RequestReplySenderContext</code> and <code>RequestReplyReceiverContext</code> for the client and server side respectively.</p>
</div>
<div class="paragraph">
<p>As an example for the client side we will use a handler that instruments the HTTP request by adding a <code>foo:bar</code> header (if you have Micrometer Tracing on the classpath you could reuse the <code>PropagatingSenderTracingObservationHandler</code> and <code>PropagatingReceiverTracingObservationHandler</code> to propagate tracing context over the wire). Let&#8217;s look at the example of such a handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static class HeaderPropagatingHandler implements ObservationHandler&lt;SenderContext&lt;Object&gt;&gt; {

    @Override
    public void onStart(SenderContext&lt;Object&gt; context) {
        context.getSetter().set(context.getCarrier(), "foo", "bar");
    }

    @Override
    public boolean supportsContext(Observation.Context context) {
        return context instanceof SenderContext;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following of HTTP client side instrumentation that reuses the handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This example can be combined with the idea of ObservationConvention to allow
// users to easily customize the key values. Please read the rest of the
// documentation on how to do it.

// In Micrometer Tracing we would have predefined
// PropagatingSenderTracingObservationHandler but for the sake of this demo we
// create our own handler that puts "foo":"bar" headers into the request
registry.observationConfig().observationHandler(new HeaderPropagatingHandler());

// We're using WireMock to stub the HTTP GET call to "/foo" with a response "OK"
stubFor(get("/foo").willReturn(ok().withBody("OK")));

// RequestReplySenderContext is a special type of context used for request-reply
// communication. It requires to define what the Request type is and how we can
// instrument it. It also needs to know what the Response type is
RequestReplySenderContext&lt;HttpUriRequestBase, ClassicHttpResponse&gt; context = new RequestReplySenderContext&lt;&gt;(
        (carrier, key, value) -&gt; Objects.requireNonNull(carrier).addHeader(key, value));

// We're instrumenting the Apache HTTPClient
try (CloseableHttpClient httpclient = HttpClients.createDefault()) {
    // The HttpGet is our carrier (we can mutate it to instrument the headers)
    HttpGet httpget = new HttpGet(info.getHttpBaseUrl() + "/foo");
    // We must set the carrier BEFORE we run &lt;Observation#start&gt;
    context.setCarrier(httpget);
    // You can set the remote service address to provide more debugging
    // information
    context.setRemoteServiceAddress(info.getHttpBaseUrl());
    // Examples of setting key values from the request
    Observation observation = Observation.createNotStarted("http.client.requests", () -&gt; context, registry)
        .contextualName("HTTP " + httpget.getMethod())
        .lowCardinalityKeyValue("http.url", info.getHttpBaseUrl() + "/{name}")
        .highCardinalityKeyValue("http.full-url", httpget.getRequestUri());
    observation.observeChecked(() -&gt; {
        String response = httpclient.execute(httpget, classicHttpResponse -&gt; {
            // We should set the response before we stop the observation
            context.setResponse(classicHttpResponse);
            // Example of setting key values from the response
            observation.highCardinalityKeyValue("http.content.length",
                    String.valueOf(classicHttpResponse.getEntity().getContentLength()));
            return EntityUtils.toString(classicHttpResponse.getEntity());
        });

        then(response).isEqualTo("OK");
    });
}

// We want to be sure that we have successfully enriched the HTTP headers
verify(getRequestedFor(urlEqualTo("/foo")).withHeader("foo", equalTo("bar")));</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example for the server side we will use a handler that instruments the Observation by adding the <code>foo</code> low cardinality key with the value being the matched path from the HTTP request. Let&#8217;s look at the example of such a handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">static class HeaderReadingHandler implements ObservationHandler&lt;ReceiverContext&lt;Context&gt;&gt; {

    @Override
    public void onStart(ReceiverContext&lt;Context&gt; context) {
        String fooHeader = context.getGetter().get(context.getCarrier(), "foo");
        // We're setting the value of the &lt;foo&gt; header as a low cardinality key value
        context.addLowCardinalityKeyValue(KeyValue.of("foo", fooHeader));
    }

    @Override
    public boolean supportsContext(Observation.Context context) {
        return context instanceof ReceiverContext;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at the following of HTTP server side instrumentation that reuses the handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// This example can be combined with the idea of ObservationConvention to allow
// users to easily customize the key values. Please read the rest of the
// documentation on how to do it.

// In Micrometer Tracing we would have predefined
// PropagatingReceiverTracingObservationHandler but for the sake of this demo we
// create our own handler that will reuse the &lt;foo&gt; header from the request as a
// low cardinality key value
registry.observationConfig().observationHandler(new HeaderReadingHandler());

try (Javalin javalin = Javalin.create().before("/hello/{name}", ctx -&gt; {
    // We're creating the special RequestReplyReceiverContext that will reuse the
    // information from the HTTP headers
    RequestReplyReceiverContext&lt;Context, Context&gt; receiverContext = new RequestReplyReceiverContext&lt;&gt;(
            Context::header);
    // Remember to set the carrier!!!
    receiverContext.setCarrier(ctx);
    String remoteServiceAddress = ctx.scheme() + "://" + ctx.host();
    receiverContext.setRemoteServiceAddress(remoteServiceAddress);
    // We're starting an Observation with the context
    Observation observation = Observation
        .createNotStarted("http.server.requests", () -&gt; receiverContext, registry)
        .contextualName("HTTP " + ctx.method() + " " + ctx.matchedPath())
        .lowCardinalityKeyValue("http.url", remoteServiceAddress + ctx.matchedPath())
        .highCardinalityKeyValue("http.full-url", remoteServiceAddress + ctx.path())
        .lowCardinalityKeyValue("http.method", ctx.method().name())
        .start();
    // Let's be consistent and always set the Observation related objects under
    // the same key
    ctx.attribute(ObservationThreadLocalAccessor.KEY, observation);
}).get("/hello/{name}", ctx -&gt; {
    // We need to be thread-safe - we're not using ThreadLocals, we're retrieving
    // information from the attributes
    Observation observation = ctx.attribute(ObservationThreadLocalAccessor.KEY);
    observation.scoped(() -&gt; {
        // If we need thread locals (e.g. MDC entries) we can use &lt;scoped()&gt;
        log.info("We're using scoped - Observation in thread local here [" + registry.getCurrentObservation()
                + "]");
        then(registry.getCurrentObservation()).isNotNull();
    });
    // We're returning body
    ctx.result("Hello World [" + observation.getContext().getLowCardinalityKeyValue("foo").getValue() + "]");
}).after("/hello/{name}", ctx -&gt; {
    // After sending the response we want to stop the Observation
    Observation observation = ctx.attribute(ObservationThreadLocalAccessor.KEY);
    observation.stop();
}).start(0)) {
    // We're sending an HTTP request with a &lt;foo:bar&gt; header. We're expecting that
    // it will be reused in the response
    String response = sendRequestToHelloEndpointWithHeader(javalin.port(), "foo", "bar");

    // The response must contain the value from the header
    then(response).isEqualTo("Hello World [bar]");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instrumentation_of_messaging_communication"><a class="anchor" href="#_instrumentation_of_messaging_communication"></a>Instrumentation of Messaging Communication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To instrument messaging components you should proceed in the same way as you would with <a href="#instrumentation_of_http_communication">HTTP-based communication</a>, however instead of <code>RequestReplySenderContext</code> and <code>RequestReplyReceiverContext</code> you would use <code>SenderContext</code> and <code>ReceiverContext</code>. You can also set the <code>remoteServiceName</code> on a context to suggest the name of the broker (e.g. <code>kafka</code> or <code>rabbitmq</code>).</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="handler.html">Observation Handlers</a></span>
  <span class="next"><a href="testing.html">Testing</a></span>
</nav>
</article>
</div>  </div>
</main>
<div class="modal micromodal-slide" id="modal-versions" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true">
            <main class="modal__content" id="modal-versions-content">
              <button data-micromodal-close class="modal-versions-close">
                <svg width="28px" height="28px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><defs><style>.cls-1h{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:2px;}</style></defs><title/><g id="cross"><line class="cls-1h" x1="7" x2="25" y1="7" y2="25"/><line class="cls-1h" x1="7" x2="25" y1="25" y2="7"/></g></svg>
              </button>
              <div class="colset">
                <div class="col-left">
                  <ul class="nav-versions">
                    <li class="component is-current">
                      <a class="title" href="../../index.html">Micrometer</a>
                      <ul class="versions">
                        <li class="version is-current">
                          <a href="../index.html">
                            1.13.0-SNAPSHOT
                          </a>
                        </li>
                        <li class="version">
                          <a href="../../1.12-SNAPSHOT/index.html">
                            1.12.2-SNAPSHOT
                          </a>
                        </li>
                        <li class="version is-latest">
                          <a href="../../index.html">
                            1.12.1<span class="current">current</span>
                          </a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-right">
                  <ul>
                    <li>
                      Related Documentation
                      <ul>
                        <li><a href="https://docs.micrometer.io/context-propagation/reference/">Context Propagation</a></li>
                        <li><a href="https://docs.micrometer.io/micrometer/reference/">Micrometer</a></li>
                        <li><a href="https://docs.micrometer.io/tracing/reference/">Tracing</a></li>
                        <li><a href="https://docs.micrometer.io/micrometer-docs-generator/reference/">Docs Generator</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </main>
        </div>
    </div>
</div>

</div>
<footer class="footer flex">
    <div id="spring-links">
        <img class="light" id="springlogo" src="../../_/img/micrometer-logo.svg" alt="Micrometer">
        <img class="dark" id="springlogo" src="../../_/img/micrometer-logo-dark.svg" alt="Micrometer">
        <p class="smallest antialiased">© <script>var d = new Date();
        document.write(d.getFullYear());</script> <a href="https://www.vmware.com/">VMware</a>, Inc. or its affiliates. <a href="https://www.vmware.com/help/legal.html">Terms of Use</a> • <a href="https://www.vmware.com/help/privacy.html" rel="noopener noreferrer">Privacy</a></p>
    </div>
    <div id="social-icons" class="flex jc-between">
        <a href="https://github.com/micrometer-metrics" title="GitHub"><svg id="github-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><path class="cls-1" d="M38,0a38,38,0,1,0,38,38A38,38,0,0,0,38,0Z"/></g><path class="cls-2" d="M38,15.59A22.95,22.95,0,0,0,30.71,60.3c1.15.21,1.57-.5,1.57-1.11s0-2,0-3.9c-6.38,1.39-7.73-3.07-7.73-3.07A6.09,6.09,0,0,0,22,48.86c-2.09-1.42.15-1.39.15-1.39a4.81,4.81,0,0,1,3.52,2.36c2,3.5,5.37,2.49,6.67,1.91a4.87,4.87,0,0,1,1.46-3.07c-5.09-.58-10.45-2.55-10.45-11.34a8.84,8.84,0,0,1,2.36-6.15,8.29,8.29,0,0,1,.23-6.07s1.92-.62,6.3,2.35a21.82,21.82,0,0,1,11.49,0c4.38-3,6.3-2.35,6.3-2.35a8.29,8.29,0,0,1,.23,6.07,8.84,8.84,0,0,1,2.36,6.15c0,8.81-5.37,10.75-10.48,11.32a5.46,5.46,0,0,1,1.56,4.25c0,3.07,0,5.54,0,6.29s.42,1.33,1.58,1.1A22.94,22.94,0,0,0,38,15.59Z"/></svg></a>
        <a href="https://twitter.com/micrometerio" title="Twitter"><svg id="twitter-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.93 75.93"><circle class="cls-1" cx="37.97" cy="37.97" r="37.97"/><path id="Twitter-2" data-name="Twitter" class="cls-2" d="M55.2,22.73a15.43,15.43,0,0,1-4.88,1.91,7.56,7.56,0,0,0-5.61-2.49A7.78,7.78,0,0,0,37,30a7.56,7.56,0,0,0,.2,1.79,21.63,21.63,0,0,1-15.84-8.23,8,8,0,0,0,2.37,10.52,7.66,7.66,0,0,1-3.48-1v.09A7.84,7.84,0,0,0,26.45,41a7.54,7.54,0,0,1-2,.28A7.64,7.64,0,0,1,23,41.09a7.71,7.71,0,0,0,7.18,5.47,15.21,15.21,0,0,1-9.55,3.37,15.78,15.78,0,0,1-1.83-.11,21.41,21.41,0,0,0,11.78,3.54c14.13,0,21.86-12,21.86-22.42,0-.34,0-.68,0-1a15.67,15.67,0,0,0,3.83-4.08,14.9,14.9,0,0,1-4.41,1.24A7.8,7.8,0,0,0,55.2,22.73Z"/></svg></a>
    </div>
</footer>
<script src="../../_/js/vendor/import.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/asciidoctor-tabs.js" data-sync-storage-key="docs:preferred-tab"></script>

<div class="modal micromodal-slide" id="modal-1" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1" data-micromodal-close>
        <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-1-title">
            <main class="modal__content" id="modal-1-content">
                <div id="searchbox"></div>
                <div id="counter"></div>
                <div class="search-link-box">
                    <a class="search-link" href="../../search.html">Search in all Spring Docs</a>
                </div>
                <div class="search-by">
                    <a target="_blank" rel="noopener noreferrer" href="https://www.algolia.com/" aria-label="Search by Algolia">
                        <img class="light" width="140" src="../../_/img/algolia-light.svg" />
                        <img class="dark" width="140" src="../../_/img/algolia-dark.svg" />
                    </a>
                </div>
                <div id="hits"></div>
            </main>
        </div>
    </div>
</div>

<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.17.0/dist/algoliasearch-lite.umd.js" integrity="sha256-Lf9DrpGmcRip6OQzbcL6lnvNmoZNSKpyQX5pMlwatWE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.54.1/dist/instantsearch.production.min.js" integrity="sha256-xYsZPDeNjYNTBWLvqD2Lxe98hOxcDgOHyMPfz4tVAbk=" crossorigin="anonymous"></script>
<script async id="search-script" src="../../_/js/vendor/search.js" data-app-id="R3TXPRVDPR" data-api-key="cbcaa86034c1961b2c0c73bd0c274862" data-index-name="micrometer" data-stylesheet="../../_/css/vendor/search.css" data-page-version="1.13.0" data-page-component="micrometer"></script>
  </body>
</html>
